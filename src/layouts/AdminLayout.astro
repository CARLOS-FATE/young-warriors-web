---
import jwt from 'jsonwebtoken';

// 1. GUARDIA DE SEGURIDAD (Centralizada)
// Toda página que use este layout estará protegida.
try {
  const token = Astro.cookies.get('admin_auth_token')?.value;
  if (!token) throw new Error('No hay token');
  
  // Verificamos el token con la variable de entorno
  jwt.verify(token, import.meta.env.JWT_SECRET_KEY);

} catch (error) {
  // Si falla (expirado, inválido, no existe), redirigimos al login
  console.error('Error de autenticación:', error.message);
  return Astro.redirect('/admin/login?error=auth');
}

// 2. PROPIEDADES (Props)
// Definimos una 'prop' para que cada página pueda establecer su propio título
interface Props {
  title: string;
}
const { title } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  
  <style is:global>
    body { 
      font-family: Arial, sans-serif; 
      line-height: 1.6; 
      margin: 20px; 
      background-color: #f9f9f9;
    }
    /* Puedes poner más estilos globales del panel de admin aquí */
  </style>
</head>
<body>
  
  <main>
    <slot />
  </main>

  </body>
</html>