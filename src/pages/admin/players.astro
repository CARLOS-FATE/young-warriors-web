---
// src/pages/admin/players.astro
import jwt from 'jsonwebtoken';

// 1. Guardia de seguridad
const token = Astro.cookies.get('admin_auth_token')?.value;
try {
  if (!token) throw new Error('No hay token de autenticación');
  jwt.verify(token, import.meta.env.JWT_SECRET_KEY);
} catch (error) {
  return Astro.redirect('/admin/login?error=auth');
}

// 2. Obtener datos
import { query } from '../../../lib/db.js';
interface Player {
  id: number;
  name: string;
  position: string;
}
const sql = "SELECT id, name, position FROM players ORDER BY id DESC";
const players = await query({ query: sql }) as Player[];

import PlayersList from '../../components/admin/PlayersList.jsx';
---
 
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel - Administrar Jugadores</title>
</head>
<body>
    <a href="/admin" class="back-link">← Volver al Dashboard</a>
    <h1>Administrar Jugadores</h1>
    <a href="/admin/crear-player" class="add-link">Añadir Nuevo Jugador</a>
    

    <PlayersList client:load players={players} />

</body>
</html>

<style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .action-links a { margin-right: 10px; }
        .add-link { display: inline-block; margin: 20px 0; padding: 10px 15px; background-color: #28a745; color: white; border-radius: 5px; }
        .back-link { display: block; margin-bottom: 20px; }
    </style>
