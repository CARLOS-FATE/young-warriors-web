---
// src/pages/admin/coaches.astro
import jwt from 'jsonwebtoken';

// 1. Guardia de seguridad (¡Perfecto!)
const token = Astro.cookies.get('admin_auth_token')?.value;
try {
  if (!token) throw new Error('No hay token');
  jwt.verify(token, import.meta.env.JWT_SECRET_KEY);
} catch (error) {
  return Astro.redirect('/admin/login?error=auth'); 
}

// 2. Obtener datos (¡Perfecto!)
import { query } from '../../../lib/db.js';
interface Coach { id: number; name: string; role: string; }
const sql = "SELECT id, name, role FROM coaches ORDER BY id DESC";
const coaches = await query({ query: sql }) as Coach[];

// 3. ¡Importamos nuestro nuevo componente React!
import CoachesList from '../../components/admin/CoachesList.jsx';
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Entrenadores</title>
</head>
<body>

    <h1>Administrar Entrenadores</h1>
    <a href="/admin/crear-entrenador" class="add-link">Añadir Nuevo Entrenador</a>
    <CoachesList client:load coaches={coaches} />

</body>
</html>

<style>
    body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .action-links a { margin-right: 10px; }
    .add-link { display: inline-block; margin-top: 20px; padding: 10px 15px; background-color: #28a745; color: white; border-radius: 5px; }
</style>