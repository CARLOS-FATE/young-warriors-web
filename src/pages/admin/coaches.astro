---
// src/pages/admin/coaches.astro

import jwt from 'jsonwebtoken';

const token = Astro.cookies.get('admin_auth_token')?.value;
let payload;

try {

    if (!token) {
    throw new Error('No hay token de autenticación');
  }
  payload = jwt.verify(token, import.meta.env.JWT_SECRET_KEY);
    
} catch (error) {
  return Astro.redirect('/admin/login?error=auth'); 
}

import { query } from '../../../lib/db.js';
interface Coach {
  id: number;
  name: string;
  role: string;
}
const sql = "SELECT id, name, role FROM coaches ORDER BY id DESC";
const coaches = await query({ query: sql }) as Coach[];

---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Entrenadores</title>
    </head>
<body>

    <h1>Administrar Entrenadores</h1>

    <a href="/admin/crear-entrenador" class="add-link">Añadir Nuevo Entrenador</a>
   
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Rol</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            
            {coaches.length > 0 ? (
                coaches.map(coach => (
                    <tr>
                        <td>{coach.id}</td>
                        <td>{coach.name}</td>
                        <td>{coach.role}</td>
                        <td class="action-links">
                            <a href={`/admin/editar-entrenador?id=${coach.id}`}>Editar</a>
                            <a href={`/api/admin/eliminar.js?id=${coach.id}`} onclick='return confirm("¿Estás seguro?");'>Eliminar</a>  
                            
                                                  </td>
                    </tr>
                ))
            ) : (
                <tr><td colspan="4">No hay entrenadores registrados.</td></tr>
            )}
        </tbody>
    </table>

</body>
</html>

<style>
    body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .action-links a { margin-right: 10px; }
    .add-link { display: inline-block; margin-top: 20px; padding: 10px 15px; background-color: #28a745; color: white; border-radius: 5px; }
</style>